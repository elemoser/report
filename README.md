# Report

This GitHub repository contains all the files for the web application *report* created as part of the *Objektorienterade webbteknologier* (a.k.a [mvc](https://dbwebb.se/kurser/mvc-v2)) course at Blekinge Tekniska HÃ¶gskolan. The web application is created with object-oriented PHP and Symfony framework. The database used is SQLite, and for managing the interaction with the database, I employ the ORM framework Doctrine. To ensure code quality, I utilize tools such as PHP Coding Standards Fixer, PHPMD, and PHPStan. Additionally, I use PHPUnit to perform unit tests on the classes in the *scr* folder. To further enhance quality assurance, I rely on reports generated by PHPMetrics and Scrutinizer, which help identify vulnerabilities in the code.

Below are the badges from the (latest) Scrutinizer analysis results:

[![Scrutinizer Code Quality](https://scrutinizer-ci.com/g/elemoser/report/badges/quality-score.png?b=main)](https://scrutinizer-ci.com/g/elemoser/report/?branch=main) [![Code Coverage](https://scrutinizer-ci.com/g/elemoser/report/badges/coverage.png?b=main)](https://scrutinizer-ci.com/g/elemoser/report/?branch=main) [![Build Status](https://scrutinizer-ci.com/g/elemoser/report/badges/build.png?b=main)](https://scrutinizer-ci.com/g/elemoser/report/build-status/main) [![Code Intelligence Status](https://scrutinizer-ci.com/g/elemoser/report/badges/code-intelligence.svg?b=main)](https://scrutinizer-ci.com/code-intelligence)

Note that I use PHPDoc to generate comprehensive documentation of the source code.

## Application

Here is how you clone and start the application:

```
# clone repo with HTTPS
git clone https://github.com/elemoser/report.git

# run application
php -S localhost:8888 -t public
```

For debugging the application routes, you can run the following commands.

```
# Show the routes
php bin/console debug:router

# Match a specific route
php bin/console router:match /lucky/number

# Clear the cache
php bin/console cache:clear

# Show available commands
php bin/console

```

### Database

For my database backend, I opted for SQLite, and I utilized the ORM framework Doctrine to handle database interactions.
I followed [this guide](https://github.com/dbwebb-se/mvc/tree/main/example/symfony-doctrine) to set up Doctrine and integrate it with the database *var/data.db*.
Here is a summary of the most important commands for setting up a database with Doctrine:

```
# Debug the dotenv and verify the dotenv settings
php bin/console debug:dotenv

# create database
php bin/console doctrine:database:create

# create new entity class
php bin/console make:entity

# migration
php bin/console make:migration
php bin/console doctrine:migrations:migrate

# create Controller
php bin/console make:controller SomeController

# run SQL towards the database
php bin/console dbal:run-sql 'SELECT * FROM product'
```

As part of the database set up, I created an Entity class for each table in the database, which can be viewed in the folder *src/Entity/*. In the folder *src/Repository/*, you can also find a Repository for each Entity class, which is created automatically by Doctrine.

For the final project (kmom10) of this course, I further created a PHP script to facilitate the transfer of data from a CSV file into the database. I followed [this tutorial](https://www.youtube.com/watch?v=TJxeIhQbn1Y&t=231s) to set up this script. The code for the script can be viewed at *src/Command/CsvImportCommand.php*. The script can be run with the following command, however ensure that all rows in the tables adventure_room and adventure_items are deleted before running the command.

```
# to run php script (src/Command/CsvImportCommand.php)
php bin/console csv:import
```

## PHP Linter and Mess Detection

TL;DR: To validate code use the following commands.

```
# validate code with all linters
composer lint

# validate code with only PHP Coding Standards Fixer
composer csfix

# validate code with only PHPMD
composer phpmd

# validate code with only PHPstan
composer phpstan

```

For more details on each of these tools, see information below.

### PHP Coding Standards Fixer

The Symfony community uses the tool "PHP Coding Standards Fixer" to format the code so it looks the same throughout all Symfony modules.
The tool does not provide any warnings or hints (as per default), it just processes your code to fix its code style.

```
# validate code with PHP Coding Standards Fixer
composer csfix:dry
composer csfix
```

### PHPMD - PHP Mess Detector

A mess detector warns you when you write "messy" code with potential problems.

```
# without config file
tools/phpmd/vendor/bin/phpmd src text cleancode,codesize,controversial,design,naming,unusedcode

# with config file
tools/phpmd/vendor/bin/phpmd . text phpmd.xml
```

### PHPStan

A linter tool that tries to "find bugs before they reach production".

```
# execute tool
tools/phpstan/vendor/bin/phpstan analyse src

# validate code on strictest level
tools/phpstan/vendor/bin/phpstan analyse -l 9 src

# with config file
tools/phpstan/vendor/bin/phpstan
```

## Unit testing with PHPUnit

PHPUnit is a unit testing framework for PHP, used to automate and streamline the testing process of individual units (methods, functions, classes) within PHP applications.

```
# execute tests
composer phpunit
```

## Phpmetrics

A tool that reads the source code and creates an HTML report containing quality metrics on the code. This type of information can indicate the level of code quality or code complexity.

```
# to run phpmetrics
tools/phpmetrics/vendor/bin/phpmetrics --config=phpmetrics.json

# or with shortcut
composer phpmetrics
```

The report can be viewed at *report/docs/metrics/index.html*.

### Scrutinizer

A continuous integration (CI) service that checks out the code on every update of your GitHub/GitLab repo, executes the test suite and to analyzes the code. As a result, a few badges show the status of the code. Here are the badges from the last update:

[![Scrutinizer Code Quality](https://scrutinizer-ci.com/g/elemoser/report/badges/quality-score.png?b=main)](https://scrutinizer-ci.com/g/elemoser/report/?branch=main) [![Code Coverage](https://scrutinizer-ci.com/g/elemoser/report/badges/coverage.png?b=main)](https://scrutinizer-ci.com/g/elemoser/report/?branch=main) [![Build Status](https://scrutinizer-ci.com/g/elemoser/report/badges/build.png?b=main)](https://scrutinizer-ci.com/g/elemoser/report/build-status/main) [![Code Intelligence Status](https://scrutinizer-ci.com/g/elemoser/report/badges/code-intelligence.svg?b=main)](https://scrutinizer-ci.com/code-intelligence)

For more information, click on one of the badges.

## Documentation with PHPDoc

A documentation generator for PHP code that extracts and organizes comments and annotations to generate comprehensive documentation for better code understanding and maintenance.

```
# generate documentation
composer phpdoc
```